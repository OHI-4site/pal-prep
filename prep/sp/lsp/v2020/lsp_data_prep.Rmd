---
title: 'OHI+ Palmyra 2020 - Lasting Special Places subgoal'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
     #in_header: '../../../workflow/templates/ohi_hdr.html' - need to update this
  pdf_document:
    toc: true
editor_options: 
  chunk_output_type: console
---

# Summary

From Halpern et al. 2012 supplemental info: 

> The ‘Lasting Special Places’ sub-goal focuses instead on those geographic locations that hold particular value for aesthetic, spiritual, cultural, recreational or existence reasons57. This sub-goal is particularly hard to quantify. Ideally one would survey every community around the world to determine the top list of special places, and then assess how those locations are faring relative to a desired state (e.g., protected or well managed). The reality is that such lists do not exist. Instead, we assume areas that are protected represent these special places (i.e. the effort to protect them suggests they are important places).

> Clearly this is an imperfect assumption but in many cases it will be true. Using lists of protected areas as the catalogue of special places then creates the problem of determining a reference condition. We do not know how many special places have yet to be protected, and so we end up having all identified special places also being protected. To solve this problem we make two important assumptions. First, we assume that all countries have roughly the same percentage of their coastal waters and coastline that qualify as lasting special places. In other words, they all have the same reference target (as a percentage of the total area). Second, we assume that the target reference level is 30% of area protected.

The model for this goal considers the inland coastal zone (up to 1 km inland) independently from, and equally weighted with, the offshore coastal zone (up to 3 nm offshore).  The status for this goal is calculated as:

$$X_{LSP} = \frac{\left(\frac{Area_{P}}{Area_{P_{ref}}} + \frac{Area_{MPA}}{Area_{MPA_{ref}}}\right)}{2}$$  


where: 

* $Area_{P}$ = Protected area for inland 1 km buffer
* ${Area_{P_{ref}}}$ = Reference value for inland protected area
* $Area_{MPA}$ = Marine protected area for offshore 3 nm buffer
* ${Area_{MPA_{ref}}}$ = Reference value for marine protected area within offshore 3 nm buffer
* $Ref$ = 30% of total area within buffer zone is protected

***

# Setup

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(sf)
library(here)

# Set filepaths and source functions
source(here('src/R/common.R'))
source(ohicore)

goal     <- 'lsp'
scenario <- 'v2020'
dir_anx       <- file.path(dir_M, 'git-annex/globalprep') 
dir_goal      <- file.path(here('globalprep', goal, scenario)) 
dir_goal_anx  <- file.path(dir_anx, goal, scenario)
dir_github    <- '~/github/pal-prep'

```

# Methods

Since 100% of Palmyra is a protected area, it would get a perfect score for the lasting special places goal. The Wildlife Refuge at Palmyra was [established in 2001](https://www.fisheries.noaa.gov/pacific-islands/habitat-conservation/pacific-remote-islands-marine-national-monument).    

Two output files are required: 

 * rgn_area_offshore3nm with the following columns: rgn_id, area ($km^2$)   
 * rgn_area_inland1km with the following columns: rgn_id, area ($km^2$)   
 * lsp_prot_area_offshore3nm with the following columns: rgn_id, year, a_prot_3nm ($km^2$)  
 * lsp_prot_area_inland1km with the following columns: rgn_id, year, a_prot_1km ($km^2$)   
 
Create the offshore region area output file:  
```{r create-rgn-area-offshore, eval=F}

# Calculate region area from the 3nm buffer shapefile:
buff_3nm <- pal_buffer_3nm %>% 
  mutate(area_m2 = st_area(.),
         area_km2 = area_m2/1000000) %>%
  separate(area_km2, into = c("area_km2", "units"), sep = " ") %>%
  dplyr::select(-area_m2, -units)

area_3nm <- as.numeric(buff_3nm$area_km2)

# Create first output file
rgn_area_offshore3nm <- data.frame(rgn_id = 1, area = area_3nm)

# Save to output folder:
write_csv(rgn_area_offshore3nm, file.path(dir_github, 'prep/sp/lsp/v2020/output/rgn_area_offshore3nm'))
```

Create inland region area output file:  
```{r create-rgn-area-inland, eval=F}

# Calculate region area from the land shapefile:
land <- pal_shoreline %>% 
  mutate(area_m2 = st_area(.),
         area_km2 = area_m2/1000000) %>%
  separate(area_km2, into = c("area_km2", "units"), sep = " ") %>%
  dplyr::select(-area_m2, -units)

# whole island is slightly over 2km so we can use the whole area 
area_1km <- as.numeric(land$area_km2)

# Create the output file
rgn_area_inland1km <- data.frame(rgn_id = 1, area = area_1km)

# Save to output folder:
write_csv(rgn_area_inland1km, file.path(dir_github, 'prep/sp/lsp/v2020/output/rgn_area_inland1km'))
```

Create the offshore protected area file
```{r create-lsp-prot-area-offshore, eval=F}
# global uses 2000-2019 for years
# Wildlife Refuge was established in 2001 so I'll use years 2001-2019

years <- seq(2001,2020,1)

# Create output file
lsp_prot_area_offshore3nm <- data.frame(rgn_id = rep(1, length(years)),
                                        year = years,
                                        a_prot_3nm = rep(area_3nm, length(years)))

# Save to output folder
write_csv(lsp_prot_area_offshore3nm, file.path(dir_github, 'prep/sp/lsp/v2020/output/lsp_prot_area_offshore3nm'))
```

Create the inland protected area file
```{r create-lsp-prot-area-inland, eval=F}
# global uses 2000-2020 for years
years <- seq(2001,2020,1)

# Create output file
lsp_prot_area_inland1km <- data.frame(rgn_id = rep(1, length(years)),
                                        year = years,
                                        a_prot_1km = rep(area_1km, length(years)))

# Save to output folder
write_csv(lsp_prot_area_inland1km, file.path(dir_github, 'prep/sp/lsp/v2020/output/lsp_prot_area_inland1km'))
```

# Calculate Status 

```{r calc_status}
# Read in the output data files:  
rgn_area_inland1km <- read_csv(file.path(dir_github, 'prep/sp/lsp/v2020/output/rgn_area_inland1km')) %>% 
  mutate(layer = "rgn_area_inland1km")

rgn_area_offshore3nm <- read_csv(file.path(dir_github, 'prep/sp/lsp/v2020/output/rgn_area_offshore3nm')) %>% 
  mutate(layer = "rgn_area_offshore3nm")

lsp_prot_area_inland1km <- read_csv(file.path(dir_github, 'prep/sp/lsp/v2020/output/lsp_prot_area_inland1km'))

lsp_prot_area_offshore3nm <- read_csv(file.path(dir_github, 'prep/sp/lsp/v2020/output/lsp_prot_area_offshore3nm'))

# Set scenario year 
scenario_year = 2020

# Set reference points - 99% of all Palmyra area protected 
ref_pct_mpa <- 99 # marine protected area
ref_pct_cpa <- 99 # coastal protected area

# calculate the percent of offshore protected areas and the status
offshore <- lsp_prot_area_offshore3nm %>% 
  mutate(area_offshore3nm = rgn_area_offshore3nm$area,
         scenario_year = 2020) %>% 
  dplyr::rename(mpa = a_prot_3nm) %>% 
  mutate(pct_mpa  = pmin(mpa  / area_offshore3nm * 100, 100),
         status   = pmin(pct_mpa / ref_pct_mpa, 1)) %>% 
  dplyr::select(region_id = rgn_id,
                year,
                status)

# calculate the percent of inland protected areas and the status
inland <- lsp_prot_area_inland1km %>% 
  mutate(area_inland1km = rgn_area_inland1km$area,
         scenario_year = 2020) %>% 
  dplyr::rename(cpa = a_prot_1km) %>% 
  mutate(pct_cpa  = pmin(cpa  / area_inland1km * 100, 100),
         status   = pmin(pct_cpa / ref_pct_cpa, 1)) %>% 
  dplyr::select(region_id = rgn_id,
                year,
                status)
```

Save the two output to the toolbox as 'lsp_offshore.csv' and 'lsp_inland.csv'   
```{r save-to-toolbox}
dir_scores <- '~/github/pal-scores/region'

write_csv(offshore, file.path(dir_scores, 'layers/lsp_offshore.csv'))
write_csv(inland, file.path(dir_scores, 'layers/lsp_inland.csv'))
```

